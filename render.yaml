# render.yaml â€” Deploy backend on Render.com
# Docs: https://render.com/docs/yaml-spec

services:
  - type: web
    name: cbse-tutor-backend
    runtime: python
    rootDir: backend
    region: singapore          # closest to India
    plan: free                 # upgrade to starter for always-on
    buildCommand: |
      pip install -r requirements.txt &&
      python manage.py collectstatic --noinput
    releaseCommand: python manage.py migrate --noinput
    startCommand: gunicorn cbse_tutor.wsgi:application --bind 0.0.0.0:$PORT --workers 2 --threads 4 --timeout 120
    envVars:
      - key: DJANGO_SETTINGS_MODULE
        value: cbse_tutor.settings
      - key: DEBUG
        value: "False"
      - key: DJANGO_SECRET_KEY
        generateValue: true          # Render auto-generates a secure value
      - key: DATABASE_URL
        fromDatabase:
          name: cbse-tutor-db
          property: connectionString
      - key: GROQ_API_KEY
        sync: false                  # Set manually in Render dashboard
      - key: PINECONE_API_KEY
        sync: false
      - key: PINECONE_INDEX_NAME
        value: cbse-tutor
      - key: EMBEDDING_MODEL
        value: all-MiniLM-L6-v2
      - key: CORS_ORIGINS
        sync: false                  # Set to your Vercel URL, e.g. https://yourapp.vercel.app
      - key: RENDER
        value: "true"

databases:
  - name: cbse-tutor-db
    databaseName: cbse_tutor
    user: cbse_tutor_user
    plan: free
